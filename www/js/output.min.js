angular.module("starter", [ "ionic", "starter.controllers", "starter.services" ]).config(function($stateProvider, $urlRouterProvider) {
    $stateProvider.state("tab", {
        url: "/tab",
        "abstract": true,
        templateUrl: "templates/tabs.html",
        controller: "HideCtrl"
    }).state("tab.dash", {
        url: "/dash",
        views: {
            "tab-dash": {
                templateUrl: "templates/tab-dash.html",
                controller: "DashCtrl"
            }
        }
    }).state("tab.factures", {
        url: "/factures",
        views: {
            "tab-factures": {
                templateUrl: "templates/tab-factures.html",
                controller: "FacturesCtrl"
            }
        }
    }).state("tab.friend-detail", {
        url: "/friend/:friendId",
        views: {
            "tab-friends": {
                templateUrl: "templates/friend-detail.html",
                controller: "FriendDetailCtrl"
            }
        }
    });
    $urlRouterProvider.otherwise("/tab/dash");
});

angular.module("starter.controllers", []).controller("ContentController", [ "$scope", function($scope, $ionicSideMenuDelegate) {
    $scope.toggleLeft = function() {
        $ionicSideMenuDelegate.toggleLeft();
    };
} ]).controller("DashCtrl", function($scope, $state) {
    $scope.goto = function(stateName) {
        $state.go(stateName);
    };
}).controller("FacturesCtrl", function($scope, Factures) {
    $scope.factures = Factures.all();
}).controller("FriendDetailCtrl", function($scope, $stateParams, Friends) {
    $scope.friend = Friends.get($stateParams.friendId);
}).controller("HideCtrl", function($scope) {
    console.log("HideCtrl");
    var tabs = document.querySelectorAll("div.tabs")[0];
    tabs = angular.element(tabs);
    tabs.css("display", "none");
    $scope.$on("$destroy", function() {
        console.log("HideCtrl destroy");
        tabs.css("display", "");
    });
});

angular.module("starter.services", []).factory("Factures", function() {
    var factures = [ {
        id: 0,
        name: "Scruff McGruff"
    }, {
        id: 1,
        name: "G.I. Joe"
    }, {
        id: 2,
        name: "Miss Frizzle"
    }, {
        id: 3,
        name: "Ash Ketchum"
    } ];
    return {
        all: function() {
            return factures;
        },
        get: function(factureId) {
            return factures[factureId];
        }
    };
});